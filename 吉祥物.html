<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8" />
    <title>Three.js GLTF 模型加载示例</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
        }

        canvas {
            display: block;
        }

        @font-face {
            font-family: 'YouYuan';
            src: url('') format('truetype');
        }
    </style>
</head>

<body>
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.180.0/build/three.module.js",
          "three/addons/": "https://unpkg.com/three@0.180.0/examples/jsm/"
        }
      }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

        // === 主场景 ===
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x5599ee);

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(2, 2, 4);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // === 灯光 ===
        const light = new THREE.DirectionalLight(0xffffff, 7);
        light.position.set(5, 10, 7.5);
        scene.add(light);

        const ambient = new THREE.AmbientLight(0xffffff, 2);
        scene.add(ambient);

        // === 控制器 ===
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        // === HUD 层 ===
        const hudScene = new THREE.Scene();
        const hudCamera = new THREE.OrthographicCamera(
            -window.innerWidth / 2, window.innerWidth / 2,
            window.innerHeight / 2, -window.innerHeight / 2,
            0, 10
        );

        // 创建 Canvas + Sprite
        const canvas = document.createElement('canvas');
        canvas.width = 512;
        canvas.height = 128;
        const ctx = canvas.getContext('2d');
        ctx.font = "48px YouYuan";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillStyle = "#ffffff";
        ctx.fillText("已下载 0 KB", canvas.width / 2, canvas.height / 2);

        const texture = new THREE.CanvasTexture(canvas);
        const material = new THREE.SpriteMaterial({ map: texture });
        const sprite = new THREE.Sprite(material);
        sprite.scale.set(400, 100, 1); // HUD 屏幕大小
        sprite.position.set(0, 0, 0);  // HUD 层中心
        hudScene.add(sprite);

        // === 加载 GLTF 模型 ===
        let download = 0;
        const loader = new GLTFLoader();
        var 吉祥物;
        loader.load(
            'https://raw.dgithub.xyz/6833321/6833321.github.io/refs/heads/main/writer/class/%E5%90%89%E7%A5%A5%E7%89%A9.glb',
            (gltf) => {
                scene.add(gltf.scene);
                sprite.visible = false; // 下载完成隐藏
                吉祥物 = gltf.scene;
            },
            (xhr) => {
                download = xhr.loaded / 1024;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillText(`已下载 ${download.toFixed(2)} KB`, canvas.width / 2, canvas.height / 2);
                texture.needsUpdate = true;
            }
        );

        // === 自适应窗口 ===
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);

            hudCamera.left = -window.innerWidth / 2;
            hudCamera.right = window.innerWidth / 2;
            hudCamera.top = window.innerHeight / 2;
            hudCamera.bottom = -window.innerHeight / 2;
            hudCamera.updateProjectionMatrix();
        });

        // === 动画循环 ===
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
            renderer.autoClear = false;
            renderer.render(hudScene, hudCamera); // 渲染 HUD 层
            renderer.autoClear = true;
            吉祥物.rotation.y += 0.05;
            吉祥物.position.y += Math.sin(Date.now() * 0.005) * 0.01;
        }
        animate();
    </script>
</body>

</html>